import{r as n,j as e,u as J,T as j,L as Q,h as ee,P as te}from"./index-DCB7m4zY.js";import{C as H}from"./react-apexcharts.min-NDUHfkFc.js";import{S as se}from"./Select-G5vYENGa.js";import{T as ne,d as re,b as ae,c as ie}from"./index-CeM8WV_J.js";import{B as k}from"./Badge-DVQfnGdb.js";import{i as B}from"./tippy-react.esm-CzMw5aqO.js";import"./index-Chjiymov.js";import"./index-DNqhhwWo.js";const F=s=>n.createElement("svg",{className:"size-5",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",...s},n.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.6501 11.9996C3.6501 7.38803 7.38852 3.64961 12.0001 3.64961C16.6117 3.64961 20.3501 7.38803 20.3501 11.9996C20.3501 16.6112 16.6117 20.3496 12.0001 20.3496C7.38852 20.3496 3.6501 16.6112 3.6501 11.9996ZM12.0001 1.84961C6.39441 1.84961 1.8501 6.39392 1.8501 11.9996C1.8501 17.6053 6.39441 22.1496 12.0001 22.1496C17.6058 22.1496 22.1501 17.6053 22.1501 11.9996C22.1501 6.39392 17.6058 1.84961 12.0001 1.84961ZM10.9992 7.52468C10.9992 8.07697 11.4469 8.52468 11.9992 8.52468H12.0002C12.5525 8.52468 13.0002 8.07697 13.0002 7.52468C13.0002 6.9724 12.5525 6.52468 12.0002 6.52468H11.9992C11.4469 6.52468 10.9992 6.9724 10.9992 7.52468ZM12.0002 17.371C11.586 17.371 11.2502 17.0352 11.2502 16.621V10.9445C11.2502 10.5303 11.586 10.1945 12.0002 10.1945C12.4144 10.1945 12.7502 10.5303 12.7502 10.9445V16.621C12.7502 17.0352 12.4144 17.371 12.0002 17.371Z",fill:"#0BA5EC"})),Y=s=>n.createElement("svg",{className:"fill-current",width:"1em",height:"1em",viewBox:"0 0 13 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},n.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.06462 1.62393C6.20193 1.47072 6.40135 1.37432 6.62329 1.37432C6.6236 1.37432 6.62391 1.37432 6.62422 1.37432C6.81631 1.37415 7.00845 1.44731 7.15505 1.5938L10.1551 4.5918C10.4481 4.88459 10.4483 5.35946 10.1555 5.65246C9.86273 5.94546 9.38785 5.94562 9.09486 5.65283L7.37329 3.93247L7.37329 10.125C7.37329 10.5392 7.03751 10.875 6.62329 10.875C6.20908 10.875 5.87329 10.5392 5.87329 10.125L5.87329 3.93578L4.15516 5.65281C3.86218 5.94561 3.3873 5.94546 3.0945 5.65248C2.8017 5.35949 2.80185 4.88462 3.09484 4.59182L6.06462 1.62393Z",fill:""})),z=s=>n.createElement("svg",{className:"fill-current",width:"1em",height:"1em",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},n.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.31462 10.3761C5.45194 10.5293 5.65136 10.6257 5.87329 10.6257C5.8736 10.6257 5.8739 10.6257 5.87421 10.6257C6.0663 10.6259 6.25845 10.5527 6.40505 10.4062L9.40514 7.4082C9.69814 7.11541 9.69831 6.64054 9.40552 6.34754C9.11273 6.05454 8.63785 6.05438 8.34486 6.34717L6.62329 8.06753L6.62329 1.875C6.62329 1.46079 6.28751 1.125 5.87329 1.125C5.45908 1.125 5.12329 1.46079 5.12329 1.875L5.12329 8.06422L3.40516 6.34719C3.11218 6.05439 2.6373 6.05454 2.3445 6.34752C2.0517 6.64051 2.05185 7.11538 2.34484 7.40818L5.31462 10.3761Z",fill:""})),ce="/api/statistics/get-income-expense-summary",le="/api/statistics/get-income-expense-custom-range",oe="/api/statistics/get-top-3-recent",de="/api/statistics/amounts/monthly-by-year";function me(s=new Date().toISOString(),r,i){let d=`${ce}?referenceDate=${s}
              &period=${r}&rolloverRequired=${i}`;return fetch(d,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"}).then(c=>{if(!c.ok)throw new Error("Network response was not ok.");return c.json()})}function he(s,r){let i=`${le}?dateFrom=${s}&dateTo=${r}`;return fetch(i,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"}).then(d=>{if(!d.ok)throw new Error("Network response was not ok.");return d.json()})}function xe(){return fetch(oe,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"}).then(s=>{if(!s.ok)throw new Error("Network response was not ok.");return s.json()})}function ge(s){let r=`${de}?year=${s}`;return fetch(r,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"}).then(i=>{if(!i.ok)throw new Error("Network response was not ok.");return i.json()})}const I={getIncomeExpenseSummary:me,getIncomeExpenseCustomRange:he,getTopThreeRecentTransactions:xe,getMonthlyAmountsByYear:ge};function ue(){const r=new Date().getFullYear(),i=Array.from({length:12},(h,a)=>`${String(a+1).padStart(2,"0")}/${r}`),d=Array.from({length:5},(h,a)=>{const p=r-a;return{value:p.toString(),label:p.toString()}}),[c,t]=n.useState(!1),[m,f]=n.useState(r),[E,v]=n.useState([]),C=async h=>{t(!0),await I.getMonthlyAmountsByYear(h).then(a=>{let p=[],l=[];const D=new Map(Object.entries(a.monthlyIncomes).map(([x,g])=>[parseInt(x),g])),S=new Map(Object.entries(a.monthlyExpenses).map(([x,g])=>[parseInt(x),g]));for(let x=0;x<12;x++){const g=x+1;p.push(D.get(g)),l.push(S.get(g))}v([{name:"Thu nhập",data:p},{name:"Chi tiêu",data:l}])}).finally(()=>{t(!1)})};n.useEffect(()=>{C(m)},[m]);const b={legend:{show:!1,position:"top",horizontalAlign:"left"},colors:["#60A5FA","#F87171"],chart:{fontFamily:"Outfit, sans-serif",height:310,type:"line",toolbar:{show:!1}},stroke:{curve:"straight",width:[2,2]},fill:{type:"gradient",gradient:{opacityFrom:.55,opacityTo:0}},markers:{size:0,strokeColors:"#fff",strokeWidth:2,hover:{size:6}},grid:{xaxis:{lines:{show:!1}},yaxis:{lines:{show:!0}}},dataLabels:{enabled:!1},tooltip:{enabled:!0,x:{format:"dd MMM yyyy"}},xaxis:{type:"category",categories:i,axisBorder:{show:!1},axisTicks:{show:!1},tooltip:{enabled:!1}},yaxis:{labels:{style:{fontSize:"12px",colors:["#6B7280"]},formatter:h=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",minimumFractionDigits:0}).format(h)},title:{text:"",style:{fontSize:"0px"}}}};return e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white px-5 pb-5 pt-5 dark:border-gray-800 dark:bg-white/[0.03] sm:px-6 sm:pt-6",children:[e.jsxs("div",{className:"flex flex-col gap-5 mb-6 sm:flex-row sm:justify-between",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white/90",children:"Thống kê"}),e.jsx("p",{className:"mt-1 text-gray-500 text-theme-sm dark:text-gray-400",children:"Thống kê thu chi theo năm"})]}),e.jsx("div",{className:"flex items-start w-full gap-3 sm:justify-end",children:e.jsx(se,{options:d,placeholder:"Chọn năm",defaultValue:m+"",className:"w-32",onChange:h=>{const a=Number.parseInt(h);f(a)}})})]}),c?e.jsx("div",{className:"h-[330px] flex items-center justify-center",children:"Đang tải..."}):e.jsx("div",{className:"max-w-full overflow-x-auto custom-scrollbar",children:e.jsx("div",{className:"min-w-[1000px] xl:min-w-full",children:e.jsx(H,{options:b,series:E,type:"area",height:310})})})]})}function ye(){const s=J(),[r,i]=n.useState([]),d=()=>{I.getTopThreeRecentTransactions().then(t=>{i(t)})},c=t=>{s(`/transactions/${t}`)};return n.useEffect(()=>{d()},[]),e.jsx(e.Fragment,{children:r.length<=0?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"overflow-hidden rounded-2xl border border-gray-200 bg-white px-4 pb-3 pt-4 dark:border-gray-800 dark:bg-white/[0.03] sm:px-6",children:[e.jsx("div",{className:"flex flex-col gap-2 mb-4 sm:flex-row sm:items-center sm:justify-between",children:e.jsx("div",{children:e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white/90",children:"Những giao dịch gần đây"})})}),e.jsxs("div",{className:"max-w-full overflow-x-auto",children:[e.jsx(ne,{children:e.jsx(re,{className:"divide-y divide-gray-100 dark:divide-gray-800",children:r.map(t=>{var m;return e.jsx(ae,{className:"hover:bg-gray-50 dark:hover:bg-white/[0.03] cursor-pointer",onClick:()=>t.id!==void 0&&c&&c(t.id),children:e.jsx(ie,{className:"px-4 py-3 sm:px-6 text-start",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-8 h-8 flex items-center justify-center rounded-full border
                              ${t.transactionType===j.INCOME?"border-green-500":t.transactionType===j.EXPENSE?"border-red-500":""}`,children:t.transactionType===j.INCOME?e.jsx("i",{className:"fa-solid fa-circle-dollar-to-slot text-green-500"}):t.transactionType===j.EXPENSE?e.jsx("i",{className:"fa-solid fa-wallet text-red-500"}):null}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[e.jsxs("div",{className:"text-sm font-semibold",children:[t.description," - "," ",e.jsx("span",{className:"text-sm text-gray-400",children:t.date&&new Date(t.date).toLocaleDateString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit"})})]}),e.jsx("div",{className:"text-xs text-gray-400",children:t.merchant})]})]}),e.jsxs("div",{children:[e.jsxs("span",{className:`text-sm font-bold ${t.transactionType===j.EXPENSE?"text-red-500":"text-green-500"}`,children:[t.amount!==void 0&&t.transactionType===j.INCOME?"+":"-",(m=t==null?void 0:t.amount)==null?void 0:m.toLocaleString("vi-VN",{style:"currency",currency:"VND"})]}),e.jsx("i",{className:"text-sm fa-solid fa-ellipsis-vertical ml-6 text-gray-600 dark:text-gray-400"})]})]})})},t.id)})})}),r&&r.length>0&&e.jsx("div",{className:"text-center mt-4 text-gray-500 dark:text-gray-400",children:e.jsxs(Q,{to:"/transactions",className:"text-sm",children:["Xem tất cả các giao dịch ",e.jsx("i",{className:"fa-solid fa-arrow-right"})]})})]})]})})}function pe(){const s=new Date,r=10,i=100,d=new Date(s.getFullYear(),s.getMonth()+1,0,23,59,59,999),c=Math.ceil((d.getTime()-s.getTime())/(1e3*60*60*24)),[t,m]=n.useState(!0),[f,E]=n.useState(0),[v,C]=n.useState(0),[T,A]=n.useState(0),[b,h]=n.useState(0),[a,p]=n.useState(0),[l,D]=n.useState(0),[S,_]=n.useState(0),[x,g]=n.useState(0),[M,P]=n.useState(0),[L,G]=n.useState(0);function O(o){return o*(r/i)}function U(o,N,u){const y=N+(u<0?Math.abs(u):0),w=o+(u>0?u:0);return w===0?y>0?1.1:0:y/w}const q=async()=>{t||m(!0),await I.getIncomeExpenseSummary(new Date().toISOString(),ee.MONTH,!0).then(o=>{const N=o.income,u=o.expense,y=o.rollover,w=U(N,u,y)*i,R=N-u+y,$=w<=i-r?O(N+(y>0?y:0)):0,K=c>0?(R-$)/c:0;E(N),C(u),A(R),h(Math.abs(R)),p(w),g($),_(K),D(y),P(o.incomeChange),G(o.expenseChange)}).catch(o=>(console.error("Failed to fetch income/expense",o),null)).finally(()=>{m(!1)})};n.useEffect(()=>{q()},[]);const V="#F87171",X="#60A5FA",Z=[a],W={colors:[V],chart:{fontFamily:"Nunito, sans-serif",type:"radialBar",height:330,sparkline:{enabled:!0}},plotOptions:{radialBar:{startAngle:-85,endAngle:85,hollow:{size:"80%"},track:{background:X,strokeWidth:"100%",margin:5},dataLabels:{name:{show:!1},value:{fontSize:"24px",fontWeight:"600",offsetY:-40,color:V,formatter:function(){return b.toLocaleString("vi-VN",{style:"currency",currency:"VND"})}}}}},fill:{type:"solid",colors:[V]},stroke:{lineCap:"round"},labels:["Đã chi"]};return e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-6 dark:border-gray-800 dark:bg-white/[0.03] shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h4",{className:"text-lg font-semibold text-gray-800 dark:text-white",children:["Tổng quan thu chi tháng ",s.getMonth()+1,"/",s.getFullYear()]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 items-center",children:[e.jsx("div",{className:"flex flex-col items-center",children:t?e.jsx("div",{className:"h-[330px] flex items-center justify-center",children:"Đang tải..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"max-h-[330px]",id:"chartDarkStyle",children:e.jsx(H,{options:W,series:Z,type:"radialBar",height:330})}),e.jsx("span",{className:`absolute left-1/2 top-1/2 px-3 py-1 -translate-x-1/2
                  -translate-y-[50%] text-sm font-medium text-gray-500 dark:text-gray-400
                  ${T>=0?"text-blue-500 dark:text-blue-400":"text-error-600 dark:text-error-500"}`,children:T>=0?"Tháng này còn":"Tháng này đã quá"})]}),e.jsx("p",{className:"mt-5 text-center text-sm text-gray-500 sm:text-base",children:a<=0?"Hiện chưa ghi nhận bất kỳ khoản thu nhập hay chi tiêu mới nào, hãy ghi chép lại nhé.":a<=60&&a>0?"Chi tiêu tháng này vẫn trong giới hạn. Hãy cố gắng tiết kiệm phần còn lại nếu có thể.":a>60&&a<100?"Bạn sắp chạm ngưỡng chi tiêu tháng này, hãy tiết kiệm hơn. Cân nhắc tăng thêm thu nhập nếu có thể.":"Bạn đã vượt ngưỡng chi tiêu tháng này, hãy hạn chế chi tiêu và tìm cơ hội gia tăng thu nhập."})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Thu nhập"}),e.jsx("h4",{className:"mt-1 font-bold text-blue-600 dark:text-blue-500",children:f.toLocaleString("vi-VN",{style:"currency",currency:"VND"})})]}),!t&&f!=0&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 text-right",children:[e.jsx("div",{children:"So với tháng trước:"}),M<0?e.jsxs(k,{color:"error",className:"inline-flex items-center gap-1 mt-1",size:"sm",children:[e.jsx(z,{}),Math.abs(M).toLocaleString("vi-VN",{style:"currency",currency:"VND"})]}):e.jsxs(k,{color:"primary",className:"inline-flex items-center gap-1 mt-1",size:"sm",children:[e.jsx(Y,{}),M.toLocaleString("vi-VN",{style:"currency",currency:"VND"})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Chi tiêu"}),e.jsx("h4",{className:"mt-1 font-bold text-error-600 dark:text-error-500",children:v.toLocaleString("vi-VN",{style:"currency",currency:"VND"})})]}),!t&&v!=0&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 text-right",children:[e.jsx("div",{children:"So với tháng trước:"}),L<0?e.jsxs(k,{color:"primary",className:"inline-flex items-center gap-1 mt-1",size:"sm",children:[e.jsx(z,{}),Math.abs(L).toLocaleString("vi-VN",{style:"currency",currency:"VND"})]}):e.jsxs(k,{color:"error",className:"inline-flex items-center gap-1 mt-1",size:"sm",children:[e.jsx(Y,{}),L.toLocaleString("vi-VN",{style:"currency",currency:"VND"})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center border-t pt-3",children:[e.jsxs("span",{className:"flex text-sm font-medium text-gray-700 dark:text-white/90 gap-1",children:[l>=0?"Tháng trước còn":"Tháng trước đã quá",l!=0&&e.jsx(B,{content:l>0?`Tháng trước bạn còn dư ${l.toLocaleString("vi-VN",{style:"currency",currency:"VND"})} nên khoản dư sẽ được tính sang tháng này. Bạn đã làm tốt lắm!`:`Tháng trước bạn đã tiêu quá ${Math.abs(l).toLocaleString("vi-VN",{style:"currency",currency:"VND"})} nên khoản quá hạn mức sẽ được tính sang tháng này.`,children:e.jsx(F,{className:"w-3 h-3 text-blue-500"})},"rollover-explaination")]}),e.jsx("span",{className:`font-bold text-sm
              ${l>0?"text-blue-600 dark:text-blue-500":"text-error-600 dark:text-error-500"}`,children:Math.abs(l).toLocaleString("vi-VN",{style:"currency",currency:"VND"})})]})]})]}),!t&&(f!=0||v!=0||l!=0)&&e.jsxs("div",{className:"mt-6 text-center",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-700 dark:text-white mb-2",children:"Khuyến nghị"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 text-center border-t pt-4 text-sm text-gray-600 dark:text-gray-300",children:[e.jsxs("div",{className:"mt-4 md:mt-0",children:[e.jsx("span",{className:"text-xs",children:S<0?"Trung bình cần tiết kiệm":"Mức an toàn có thể chi"}),e.jsxs("div",{className:"font-medium text-gray-800 dark:text-white/90",children:[Math.abs(S).toLocaleString("vi-VN",{style:"currency",currency:"VND"})," / ngày"]})]}),e.jsxs("div",{className:"mt-4 md:mt-0",children:[e.jsxs("span",{className:"text-xs",children:["Tháng ",s.getMonth()+1," còn"]}),e.jsx("div",{className:"font-medium text-gray-800 dark:text-white/90",children:c<=1?"Hôm nay":`${c} ngày`})]}),a<=i-r?e.jsxs("div",{className:"mt-4 md:mt-0",children:[e.jsx("div",{className:"flex justify-center text-xs",children:e.jsxs("span",{className:"flex items-center gap-1",children:["Mục tiêu tiết kiệm",e.jsx(B,{content:`Hãy cố gắng tiết kiệm được khoảng ${r}% thu nhập của bạn đến cuối tháng nhé!`,children:e.jsx(F,{className:"w-3 h-3 text-blue-500"})},"saving-goal")]})}),e.jsxs("div",{className:"font-medium text-gray-800 dark:text-white/90",children:[(x/c).toLocaleString("vi-VN",{style:"currency",currency:"VND"})," / ngày"]})]}):a<=i?e.jsxs("div",{className:"mt-4 md:mt-0",children:[e.jsx("span",{className:"text-xs",children:"Mức nên kiếm thêm"}),e.jsxs("div",{className:"font-medium text-gray-800 dark:text-white/90",children:[(O(f)/c).toLocaleString("vi-VN",{style:"currency",currency:"VND"})," / ngày"]})]}):e.jsxs("div",{className:"mt-4 md:mt-0",children:[e.jsx("span",{className:"text-xs",children:"Tiến độ hồi phục"}),e.jsxs("div",{className:"font-medium text-gray-800 dark:text-white/90",children:["Còn ",b.toLocaleString("vi-VN",{style:"currency",currency:"VND"})]})]})]})]})]})}function Ee(){return e.jsxs(e.Fragment,{children:[e.jsx(te,{title:"Home",description:"Home/Dashboard"}),e.jsxs("div",{className:"grid grid-cols-12 gap-4 md:gap-6",children:[e.jsx("div",{className:"col-span-12 xl:col-span-12",children:e.jsx(pe,{})}),e.jsx("div",{className:"col-span-12",children:e.jsx(ue,{})}),e.jsx("div",{className:"col-span-12 xl:col-span-12",children:e.jsx(ye,{})})]})]})}export{Ee as default};
