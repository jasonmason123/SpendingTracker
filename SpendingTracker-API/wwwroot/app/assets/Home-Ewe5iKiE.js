import{r as n,j as e,a as K,T as N,L as J,P as Q}from"./index-shEYQEEx.js";import{C as _}from"./react-apexcharts.min-C-80ztYC.js";import{S as ee}from"./Select-B2SmY9A_.js";import{T as te,d as se,b as ne,c as re}from"./index-D-NQAJ0N.js";import{B as C}from"./Badge-CiCt-D8-.js";import"./index-Chjiymov.js";const P=s=>n.createElement("svg",{className:"fill-current",width:"1em",height:"1em",viewBox:"0 0 13 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},n.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.06462 1.62393C6.20193 1.47072 6.40135 1.37432 6.62329 1.37432C6.6236 1.37432 6.62391 1.37432 6.62422 1.37432C6.81631 1.37415 7.00845 1.44731 7.15505 1.5938L10.1551 4.5918C10.4481 4.88459 10.4483 5.35946 10.1555 5.65246C9.86273 5.94546 9.38785 5.94562 9.09486 5.65283L7.37329 3.93247L7.37329 10.125C7.37329 10.5392 7.03751 10.875 6.62329 10.875C6.20908 10.875 5.87329 10.5392 5.87329 10.125L5.87329 3.93578L4.15516 5.65281C3.86218 5.94561 3.3873 5.94546 3.0945 5.65248C2.8017 5.35949 2.80185 4.88462 3.09484 4.59182L6.06462 1.62393Z",fill:""})),Y=s=>n.createElement("svg",{className:"fill-current",width:"1em",height:"1em",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},n.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.31462 10.3761C5.45194 10.5293 5.65136 10.6257 5.87329 10.6257C5.8736 10.6257 5.8739 10.6257 5.87421 10.6257C6.0663 10.6259 6.25845 10.5527 6.40505 10.4062L9.40514 7.4082C9.69814 7.11541 9.69831 6.64054 9.40552 6.34754C9.11273 6.05454 8.63785 6.05438 8.34486 6.34717L6.62329 8.06753L6.62329 1.875C6.62329 1.46079 6.28751 1.125 5.87329 1.125C5.45908 1.125 5.12329 1.46079 5.12329 1.875L5.12329 8.06422L3.40516 6.34719C3.11218 6.05439 2.6373 6.05454 2.3445 6.34752C2.0517 6.64051 2.05185 7.11538 2.34484 7.40818L5.31462 10.3761Z",fill:""})),ae="/api/statistics/get-income-expense-by-period",ie="/api/statistics/get-top-3-recent",ce="/api/statistics/amounts/monthly-by-year";function le(s,r){let i=`${ae}?dateFrom=${s}&dateTo=${r}`;return fetch(i,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"}).then(h=>{if(!h.ok)throw new Error("Network response was not ok.");return h.json()})}function oe(){return fetch(ie,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"}).then(s=>{if(!s.ok)throw new Error("Network response was not ok.");return s.json()})}function de(s){let r=`${ce}?year=${s}`;return fetch(r,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"}).then(i=>{if(!i.ok)throw new Error("Network response was not ok.");return i.json()})}const D={getIncomeExpenseByPeriod:le,getTopThreeRecentTransactions:oe,getMonthlyAmountsByYear:de};function me(){const r=new Date().getFullYear(),i=Array.from({length:12},(c,o)=>`${String(o+1).padStart(2,"0")}/${r}`),h=Array.from({length:5},(c,o)=>{const g=r-o;return{value:g.toString(),label:g.toString()}}),[y,t]=n.useState(!1),[l,w]=n.useState(r),[j,b]=n.useState([]),S=async c=>{t(!0),await D.getMonthlyAmountsByYear(c).then(o=>{let g=[],k=[];const m=new Map(Object.entries(o.monthlyIncomes).map(([x,u])=>[parseInt(x),u])),L=new Map(Object.entries(o.monthlyExpenses).map(([x,u])=>[parseInt(x),u]));for(let x=0;x<12;x++){const u=x+1;g.push(m.get(u)),k.push(L.get(u))}b([{name:"Thu nhập",data:g},{name:"Chi tiêu",data:k}])}).finally(()=>{t(!1)})};n.useEffect(()=>{S(l)},[l]);const M={legend:{show:!1,position:"top",horizontalAlign:"left"},colors:["#60A5FA","#F87171"],chart:{fontFamily:"Outfit, sans-serif",height:310,type:"line",toolbar:{show:!1}},stroke:{curve:"straight",width:[2,2]},fill:{type:"gradient",gradient:{opacityFrom:.55,opacityTo:0}},markers:{size:0,strokeColors:"#fff",strokeWidth:2,hover:{size:6}},grid:{xaxis:{lines:{show:!1}},yaxis:{lines:{show:!0}}},dataLabels:{enabled:!1},tooltip:{enabled:!0,x:{format:"dd MMM yyyy"}},xaxis:{type:"category",categories:i,axisBorder:{show:!1},axisTicks:{show:!1},tooltip:{enabled:!1}},yaxis:{labels:{style:{fontSize:"12px",colors:["#6B7280"]},formatter:c=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",minimumFractionDigits:0}).format(c)},title:{text:"",style:{fontSize:"0px"}}}};return e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white px-5 pb-5 pt-5 dark:border-gray-800 dark:bg-white/[0.03] sm:px-6 sm:pt-6",children:[e.jsxs("div",{className:"flex flex-col gap-5 mb-6 sm:flex-row sm:justify-between",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white/90",children:"Thống kê"}),e.jsx("p",{className:"mt-1 text-gray-500 text-theme-sm dark:text-gray-400",children:"Thống kê thu chi ở thời điểm hiện tại"})]}),e.jsx("div",{className:"flex items-start w-full gap-3 sm:justify-end",children:e.jsx(ee,{options:h,placeholder:"Chọn năm",defaultValue:l+"",className:"w-32",onChange:c=>{const o=Number.parseInt(c);w(o)}})})]}),y?e.jsx("div",{className:"h-[330px] flex items-center justify-center",children:"Đang tải..."}):e.jsx("div",{className:"max-w-full overflow-x-auto custom-scrollbar",children:e.jsx("div",{className:"min-w-[1000px] xl:min-w-full",children:e.jsx(_,{options:M,series:j,type:"area",height:310})})})]})}function xe(){const s=K(),[r,i]=n.useState([]),h=()=>{D.getTopThreeRecentTransactions().then(t=>{i(t)})},y=t=>{s(`/transactions/${t}`)};return n.useEffect(()=>{h()},[]),e.jsx(e.Fragment,{children:r.length<=0?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"overflow-hidden rounded-2xl border border-gray-200 bg-white px-4 pb-3 pt-4 dark:border-gray-800 dark:bg-white/[0.03] sm:px-6",children:[e.jsx("div",{className:"flex flex-col gap-2 mb-4 sm:flex-row sm:items-center sm:justify-between",children:e.jsx("div",{children:e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white/90",children:"Những giao dịch gần đây"})})}),e.jsxs("div",{className:"max-w-full overflow-x-auto",children:[e.jsx(te,{children:e.jsx(se,{className:"divide-y divide-gray-100 dark:divide-gray-800",children:r.map(t=>{var l;return e.jsx(ne,{className:"hover:bg-gray-50 dark:hover:bg-white/[0.03] cursor-pointer",onClick:()=>t.id!==void 0&&y&&y(t.id),children:e.jsx(re,{className:"px-4 py-3 sm:px-6 text-start",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-8 h-8 flex items-center justify-center rounded-full border
                              ${t.transactionType===N.INCOME?"border-green-500":t.transactionType===N.EXPENSE?"border-red-500":""}`,children:t.transactionType===N.INCOME?e.jsx("i",{className:"fa-solid fa-circle-dollar-to-slot text-green-500"}):t.transactionType===N.EXPENSE?e.jsx("i",{className:"fa-solid fa-wallet text-red-500"}):null}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[e.jsxs("div",{className:"text-sm font-semibold",children:[t.description," - "," ",e.jsx("span",{className:"text-sm text-gray-400",children:t.date&&new Date(t.date).toLocaleDateString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit"})})]}),e.jsx("div",{className:"text-xs text-gray-400",children:t.merchant})]})]}),e.jsxs("div",{children:[e.jsxs("span",{className:`text-sm font-bold ${t.transactionType===N.EXPENSE?"text-red-500":"text-green-500"}`,children:[t.amount!==void 0&&t.transactionType===N.INCOME?"+":"-",(l=t==null?void 0:t.amount)==null?void 0:l.toLocaleString("vi-VN",{style:"currency",currency:"VND"})]}),e.jsx("i",{className:"text-sm fa-solid fa-ellipsis-vertical ml-6 text-gray-600 dark:text-gray-400"})]})]})})},t.id)})})}),r&&r.length>0&&e.jsx("div",{className:"text-center mt-4 text-gray-500 dark:text-gray-400",children:e.jsxs(J,{to:"/transactions",className:"text-sm",children:["Xem tất cả các giao dịch ",e.jsx("i",{className:"fa-solid fa-arrow-right"})]})})]})]})})}function he(){const s=new Date,r=10,i=100,h=new Date(s.getFullYear(),s.getMonth(),1),y=new Date(s.getFullYear(),s.getMonth()+1,0,23,59,59,999),t=Math.ceil((y.getTime()-s.getTime())/(1e3*60*60*24)),[l,w]=n.useState(!0),[j,b]=n.useState(!0),[S,A]=n.useState(0),[F,M]=n.useState(0),[c,o]=n.useState(0),[g,k]=n.useState(0),[m,L]=n.useState(0),[V,x]=n.useState(0),[u,$]=n.useState(0),[R,z]=n.useState(0),[I,H]=n.useState(0),B=d=>d*(r/i),G=async()=>(l||w(!0),D.getIncomeExpenseByPeriod(h.toISOString(),y.toISOString()).then(d=>{const a=d.income,p=d.expense,v=a-p,f=Math.abs(v),E=a===0?0:p/a*i,T=E<=i-r?B(a):0,Z=t>0?(v-T)/t:0;return A(a),M(p),o(v),k(f),L(E),$(T),x(Z),{income:a,expense:p}}).catch(d=>(console.error("Failed to fetch income/expense",d),null)).finally(()=>{w(!1)})),U=async(d,a)=>{if(d===0&&a===0)return;j||b(!0);const p=new Date(s.getFullYear(),s.getMonth()-1,1),v=new Date(s.getFullYear(),s.getMonth(),0,23,59,59,999);try{const f=await D.getIncomeExpenseByPeriod(p.toISOString(),v.toISOString()),E=f.income,T=f.expense;z(d-E),H(a-T)}catch(f){console.error("Failed to fetch income/expense differences",f)}finally{b(!1)}};n.useEffect(()=>{(async()=>{const a=await G();a!=null&&await U(a==null?void 0:a.income,a==null?void 0:a.expense)})()},[]);const O="#F87171",X="#60A5FA",q=[m],W={colors:[O],chart:{fontFamily:"Nunito, sans-serif",type:"radialBar",height:330,sparkline:{enabled:!0}},plotOptions:{radialBar:{startAngle:-85,endAngle:85,hollow:{size:"80%"},track:{background:X,strokeWidth:"100%",margin:5},dataLabels:{name:{show:!1},value:{fontSize:"24px",fontWeight:"600",offsetY:-40,color:O,formatter:function(){return g.toLocaleString("vi-VN",{style:"currency",currency:"VND"})}}}}},fill:{type:"solid",colors:[O]},stroke:{lineCap:"round"},labels:["Đã chi"]};return e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-6 dark:border-gray-800 dark:bg-white/[0.03] shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h4",{className:"text-lg font-semibold text-gray-800 dark:text-white",children:["Tổng quan thu chi tháng ",s.getMonth()+1,"/",s.getFullYear()]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 items-center",children:[e.jsx("div",{className:"flex flex-col items-center",children:l?e.jsx("div",{className:"h-[330px] flex items-center justify-center",children:"Đang tải..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"max-h-[330px]",id:"chartDarkStyle",children:e.jsx(_,{options:W,series:q,type:"radialBar",height:330})}),e.jsx("span",{className:`absolute left-1/2 top-1/2 px-3 py-1 -translate-x-1/2
                  -translate-y-[50%] text-sm font-medium text-gray-500 dark:text-gray-400
                  ${c>=0?"text-blue-500 dark:text-blue-400":"text-error-600 dark:text-error-500"}`,children:c>=0?"Còn lại":"Đã quá hạn mức"})]}),e.jsx("p",{className:"mt-5 text-center text-sm text-gray-500 sm:text-base",children:m<=60&&m>0?"Chi tiêu tháng này vẫn trong giới hạn. Hãy cố gắng tiết kiệm phần còn lại nếu có thể.":m>60&&m<100?"Bạn sắp chạm ngưỡng chi tiêu tháng này, hãy tiết kiệm hơn. Cân nhắc tăng thêm thu nhập nếu có thể.":"Bạn đã vượt ngưỡng chi tiêu tháng này, hãy hạn chế chi tiêu và tìm cơ hội gia tăng thu nhập."})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Thu nhập"}),e.jsx("h4",{className:"mt-1 font-bold text-blue-600 dark:text-blue-500",children:S.toLocaleString("vi-VN",{style:"currency",currency:"VND"})})]}),!j&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 text-right",children:[e.jsx("div",{children:"So với tháng trước:"}),R<0?e.jsxs(C,{color:"error",className:"inline-flex items-center gap-1 mt-1",size:"sm",children:[e.jsx(Y,{}),Math.abs(R).toLocaleString("vi-VN",{style:"currency",currency:"VND"})]}):e.jsxs(C,{color:"primary",className:"inline-flex items-center gap-1 mt-1",size:"sm",children:[e.jsx(P,{}),R.toLocaleString("vi-VN",{style:"currency",currency:"VND"})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Chi tiêu"}),e.jsx("h4",{className:"mt-1 font-bold text-error-600 dark:text-error-500",children:F.toLocaleString("vi-VN",{style:"currency",currency:"VND"})})]}),!j&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 text-right",children:[e.jsx("div",{children:"So với tháng trước:"}),I<0?e.jsxs(C,{color:"primary",className:"inline-flex items-center gap-1 mt-1",size:"sm",children:[e.jsx(Y,{}),Math.abs(I).toLocaleString("vi-VN",{style:"currency",currency:"VND"})]}):e.jsxs(C,{color:"error",className:"inline-flex items-center gap-1 mt-1",size:"sm",children:[e.jsx(P,{}),I.toLocaleString("vi-VN",{style:"currency",currency:"VND"})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center border-t pt-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-white/90",children:c>=0?"Còn lại":"Đã quá hạn mức"}),e.jsx("span",{className:`font-semibold
              ${c>0?"text-blue-600 dark:text-blue-500":"text-error-600 dark:text-error-500"}`,children:g.toLocaleString("vi-VN",{style:"currency",currency:"VND"})})]})]})]}),!l&&e.jsxs("div",{className:"mt-6 text-center",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-700 dark:text-white mb-2",children:"Khuyến nghị"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 text-center border-t pt-4 text-sm text-gray-600 dark:text-gray-300",children:[e.jsxs("div",{className:"mt-4 md:mt-0",children:[e.jsx("span",{className:"text-xs",children:V<0?"Trung bình cần tiết kiệm":"Mức an toàn có thể chi"}),e.jsxs("div",{className:"font-medium text-gray-800 dark:text-white/90",children:[Math.abs(V).toLocaleString("vi-VN",{style:"currency",currency:"VND"})," / ngày"]})]}),e.jsxs("div",{className:"mt-4 md:mt-0",children:[e.jsxs("span",{className:"text-xs",children:["Tháng ",s.getMonth()+1," còn"]}),e.jsx("div",{className:"font-medium text-gray-800 dark:text-white/90",children:t<=1?"Hôm nay":`${t} ngày`})]}),m<=i-r?e.jsxs("div",{className:"mt-4 md:mt-0",children:[e.jsxs("span",{className:"text-xs",children:["Mục tiêu tiết kiệm (",r,"% thu nhập)"]}),e.jsx("div",{className:"font-medium text-gray-800 dark:text-white/90",children:u.toLocaleString("vi-VN",{style:"currency",currency:"VND"})})]}):m<=i?e.jsxs("div",{className:"mt-4 md:mt-0",children:[e.jsx("span",{className:"text-xs",children:"Mức nên kiếm thêm"}),e.jsxs("div",{className:"font-medium text-gray-800 dark:text-white/90",children:[(B(S)/t).toLocaleString("vi-VN",{style:"currency",currency:"VND"})," / ngày"]})]}):e.jsxs("div",{className:"mt-4 md:mt-0",children:[e.jsx("span",{className:"text-xs",children:"Tiến độ hồi phục"}),e.jsxs("div",{className:"font-medium text-gray-800 dark:text-white/90",children:["Còn ",Math.abs(c).toLocaleString("vi-VN",{style:"currency",currency:"VND"})]})]})]})]})]})}function je(){return e.jsxs(e.Fragment,{children:[e.jsx(Q,{title:"Home",description:"Home/Dashboard"}),e.jsxs("div",{className:"grid grid-cols-12 gap-4 md:gap-6",children:[e.jsx("div",{className:"col-span-12 xl:col-span-12",children:e.jsx(he,{})}),e.jsx("div",{className:"col-span-12",children:e.jsx(me,{})}),e.jsx("div",{className:"col-span-12 xl:col-span-12",children:e.jsx(xe,{})})]})]})}export{je as default};
