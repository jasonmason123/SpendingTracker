import{r as l,j as e,u as S,a as E,f as T,R as M,P as O,T as C}from"./index-BRHPLc3Q.js";import{P as D}from"./PageBreadCrumb-DfFkRX6n.js";import{S as L}from"./Select-C5_D4Y-A.js";import{B as P}from"./Button-t0aZ2z4g.js";import{I as w}from"./InputField-0YEEKdm4.js";import{D as I}from"./date-picker-BPPfZDje.js";import{a as A,u as V,c as $}from"./TransactionApiCaller-0lhDSXKd.js";import{M as R}from"./index-D9k6qkHs.js";import{f as q}from"./CategoryApiCaller-CDAWkfrK.js";import"./Label-r0pm5nj9.js";const B=({options:x,placeholder:s="Select an option",onChange:j,required:o,className:n="",defaultValue:h="",disabled:g=!1,modalTitle:v})=>{const[c,u]=l.useState(h),[a,i]=l.useState(!1),[p,m]=l.useState("");l.useEffect(()=>{u(h)},[x]);const N=l.useMemo(()=>{const d=x.find(b=>b.value==c);return(d==null?void 0:d.label)??""},[x,c]),y=l.useMemo(()=>x.filter(d=>d.label.toLowerCase().includes(p.toLowerCase())),[x,p]),f=()=>{g||(i(!0),m(""))},t=()=>i(!1),r=d=>{u(d),j(d),t()},k=g?" text-gray-500 border-gray-300 opacity-40 bg-gray-100 cursor-not-allowed dark:bg-gray-800 dark:text-gray-400 dark:border-gray-700":"";return e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",disabled:g,onClick:f,className:`relative h-11 w-full appearance-none rounded-lg border border-gray-300 px-4 py-2.5 pr-11 text-left text-sm shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 ${c?"text-gray-800 dark:text-white/90":"text-gray-400 dark:text-gray-400"} ${k} ${n}`,"aria-required":o,children:[e.jsx("span",{children:c?N:s}),e.jsx("span",{className:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400",children:e.jsx("i",{className:"fa-solid fa-chevron-down"})})]}),e.jsx(R,{isOpen:a,onClose:t,showCloseButton:!1,className:"max-w-md w-[90%] mx-auto p-4",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("div",{children:e.jsx("h3",{className:"text-base font-semibold text-gray-800 dark:text-white/90",children:v||s})}),e.jsx("input",{type:"text",value:p,onChange:d=>m(d.target.value),placeholder:"Tìm kiếm...",className:"w-full px-3 py-2 text-sm border rounded-lg border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90"}),e.jsx("div",{className:"max-h-80 overflow-y-auto rounded-xl border border-gray-200 dark:border-gray-800",children:e.jsx("ul",{className:"divide-y divide-gray-100 dark:divide-white/10",children:y.length>0?y.map(d=>{const b=d.value==c;return e.jsx("li",{children:e.jsxs("button",{type:"button",className:`w-full text-left px-4 py-3 text-sm transition flex items-center justify-between hover:bg-gray-50 dark:hover:bg-white/[0.04] ${b?"bg-brand-50/60 text-brand-700 dark:bg-white/[0.03] dark:text-brand-400":"text-gray-700 dark:text-gray-300"}`,onClick:()=>r(d.value),children:[e.jsx("span",{children:d.label}),b&&e.jsx("span",{className:"ml-3 text-brand-600 dark:text-brand-400",children:e.jsx("i",{className:"fa-solid fa-check"})})]})},d.value)}):e.jsx("li",{className:"px-4 py-3 text-sm text-gray-400 dark:text-gray-500",children:"No results found"})})}),c&&e.jsx("div",{className:"pt-2",children:e.jsx("button",{type:"button",onClick:()=>{u(""),j("")},className:"w-full px-4 py-2 text-sm text-red-500 hover:text-red-600 dark:text-red-400 dark:hover:text-red-300 border border-red-300 rounded-lg hover:bg-red-50 dark:border-red-600 dark:hover:bg-red-900/30",children:"Xóa lựa chọn"})})]})})]})},F=[{value:C.INCOME+"",label:"Thu nhập"},{value:C.EXPENSE+"",label:"Chi tiêu"}];function Z(){var y,f;const x=S(),{id:s}=E(),o=(y=T().state)==null?void 0:y.transaction,[n,h]=l.useState(!1),[g,v]=l.useState(!0),[c,u]=l.useState([]),[a,i]=l.useState(),p=M.useRef(null),m=(t,r)=>{alert("Có lỗi xảy ra, vui lòng thử lại sau."),console.error(t,r)},N=async t=>{if(t.preventDefault(),!!confirm("Bạn có chắc chắn muốn lưu?")&&a)try{h(!0);let r={};s?r=await V(a):r=await $(a),alert("Đã lưu giao dịch thành công!");const k=r.id?`/transactions/${r.id}`:s?`/transactions/${s}`:"/transactions";x(k)}catch(r){m("Error saving transaction:",r)}finally{h(!1)}};return l.useEffect(()=>{o&&s?i(o):!o&&s&&(h(!0),A(parseInt(s)).then(t=>{i({...t,date:t.date&&new Date(t.date),createdAt:t.createdAt&&new Date(t.createdAt),updatedAt:t.updatedAt&&new Date(t.updatedAt)})}).catch(t=>{m("Error fetching transaction:",t)}).finally(()=>{h(!1)}))},[]),l.useEffect(()=>{q().then(t=>{u(t)}).catch(t=>{m("Error fetching category options:",t)}).finally(()=>{v(!1)})},[]),e.jsxs(e.Fragment,{children:[e.jsx(O,{title:s?"Cập nhật giao dịch":"Tạo giao dịch mới",description:s?"Cập nhật giao dịch":"Tạo giao dịch mới"}),e.jsx(D,{pageTitles:[{title:"Giao dịch",path:"/transactions"},{title:s?"Cập nhật giao dịch":"Tạo giao dịch mới",path:s?`/transactions/${s}/edit`:"/transactions/create"}]}),e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-5 dark:border-gray-800 dark:bg-white/[0.03] lg:p-6",children:[e.jsx("h3",{className:"mb-5 text-lg font-semibold text-gray-800 dark:text-white/90 lg:mb-7",children:s?"Cập nhật giao dịch":"Tạo giao dịch mới"}),e.jsxs("form",{className:"space-y-6",onSubmit:N,children:[e.jsx("div",{className:"p-5 border border-gray-200 rounded-2xl dark:border-gray-800 lg:p-6",children:e.jsx("div",{className:"flex flex-col gap-6 lg:flex-row lg:items-start lg:justify-between",children:e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 dark:text-white/90 lg:mb-6",children:s?`Mã giao dịch: ${s}`:"Thông tin giao dịch"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-3 lg:gap-7 2xl:gap-x-32",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"mb-2 text-xs leading-normal text-gray-500 dark:text-gray-400",children:["Mô tả ngắn",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("p",{className:"text-sm font-medium text-gray-800 dark:text-white/90",children:e.jsx(w,{required:!0,disabled:n,placeholder:"VD: Đi ăn ngoài",maxLength:40,value:(a==null?void 0:a.description)||"",onChange:t=>i(r=>({...r,description:t.target.value}))})})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"mb-2 text-xs leading-normal text-gray-500 dark:text-gray-400",children:["Bên giao dịch",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"text-sm font-medium text-gray-800 dark:text-white/90",children:e.jsx(w,{disabled:n,placeholder:"Người, tổ chức giao dịch",required:!0,value:(a==null?void 0:a.merchant)||"",onChange:t=>i(r=>({...r,merchant:t.target.value}))})})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"mb-2 text-xs leading-normal text-gray-500 dark:text-gray-400",children:["Ngày",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"text-sm font-medium text-gray-800 dark:text-white/90",children:e.jsx(I,{id:"date",mode:"single",required:!0,disabled:n,defaultDate:(a==null?void 0:a.date)||void 0,confirmOnly:!1,onChange:t=>{t&&t[0]&&i(r=>({...r,date:t[0]}))},placeholder:"Ngày giao dịch",instanceRef:t=>p.current=t})})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"mb-2 text-xs leading-normal text-gray-500 dark:text-gray-400",children:["Loại giao dịch",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"text-sm font-medium text-gray-800 dark:text-white/90",children:e.jsx(L,{required:!0,disabled:n,placeholder:"Chọn loại giao dịch",options:F,defaultValue:(f=o==null?void 0:o.transactionType)==null?void 0:f.toString(),onChange:t=>{i(r=>({...r,transactionType:t}))}})})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"mb-2 text-xs leading-normal text-gray-500 dark:text-gray-400",children:[a&&a.transactionType==C.INCOME?"Khoản nhận về (VNĐ)":"Khoản đã chi (VNĐ)",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"text-sm font-medium text-gray-800 dark:text-white/90",children:e.jsx(w,{required:!0,disabled:n,placeholder:1e4.toLocaleString("vi-VN",{style:"currency",currency:"VND"}),type:"number",value:(a==null?void 0:a.amount)||"",onChange:t=>i(r=>({...r,amount:parseFloat(t.target.value)}))})})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"mb-2 text-xs leading-normal text-gray-500 dark:text-gray-400",children:["Phân loại giao dịch",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"text-sm font-medium text-gray-800 dark:text-white/90",children:e.jsx(B,{defaultValue:(a==null?void 0:a.categoryId)+"",disabled:n||g,options:c,onChange:t=>{i(r=>({...r,categoryId:parseInt(t)}))},placeholder:n||g?"Đang tải...":"Chọn danh mục"})})]})]})]})})}),e.jsx("div",{className:"flex justify-end gap-4",children:e.jsx(P,{size:"sm",type:"submit",disabled:n,children:"Lưu"})})]})]})]})}export{Z as default};
